<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çš‡å† æ•°æ®ç›‘æ§</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .status {
            display: flex;
            gap: 20px;
            align-items: center;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ccc;
        }
        
        .status-dot.connected {
            background: #52c41a;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab.active {
            background: #1890ff;
            color: white;
        }
        
        .match-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .match-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .teams {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 15px 0;
        }
        
        .team {
            flex: 1;
            text-align: center;
        }
        
        .team-name {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 5px;
        }
        
        .score {
            font-size: 24px;
            font-weight: bold;
            color: #1890ff;
            margin: 0 20px;
        }
        
        .vs {
            font-size: 14px;
            color: #999;
            margin: 0 20px;
        }
        
        .markets {
            display: grid;
            gap: 10px;
            margin-top: 15px;
        }
        
        .market {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
        }
        
        .market-title {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .odds-row {
            display: flex;
            gap: 10px;
        }
        
        .odds-item {
            flex: 1;
            background: white;
            padding: 8px;
            border-radius: 4px;
            text-align: center;
        }
        
        .odds-label {
            font-size: 11px;
            color: #999;
        }
        
        .odds-value {
            font-size: 14px;
            font-weight: 500;
            margin-top: 4px;
        }
        
        .state-badge {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .state-live {
            background: #fff1f0;
            color: #cf1322;
        }
        
        .empty {
            text-align: center;
            padding: 60px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ† çš‡å† æ•°æ®ç›‘æ§</h1>
        <div class="status">
            <div class="status-dot" id="statusDot"></div>
            <span id="statusText">è¿æ¥ä¸­...</span>
            <span>æ»šçƒ: <strong id="liveCount">0</strong></span>
            <span>ä»Šæ—¥: <strong id="todayCount">0</strong></span>
            <span>æ—©ç›˜: <strong id="earlyCount">0</strong></span>
        </div>
    </div>

    <div class="tabs">
        <button class="tab active" data-type="live">ğŸ”´ æ»šçƒ</button>
        <button class="tab" data-type="today">ğŸ“… ä»Šæ—¥</button>
        <button class="tab" data-type="early">â° æ—©ç›˜</button>
    </div>

    <div id="matchesContainer">
        <div class="empty">ç­‰å¾…æ•°æ®åŠ è½½...</div>
    </div>

    <script>
        let ws = null;
        let currentType = 'live';
        let matches = { live: [], today: [], early: [] };

        // è‡ªåŠ¨æ£€æµ‹ WebSocket åœ°å€
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const host = window.location.hostname;
        const wsPort = '8080';  // WebSocket æœåŠ¡å™¨ç«¯å£
        const WS_URL = `${protocol}//${host}:${wsPort}`;
        const AUTH_TOKEN = 'your-token-here';  // è¯·åœ¨æœåŠ¡å™¨ä¸Šä¿®æ”¹ä¸ºå®é™… Token

        function connect() {
            ws = new WebSocket(WS_URL);

            ws.onopen = () => {
                document.getElementById('statusDot').classList.add('connected');
                document.getElementById('statusText').textContent = 'å·²è¿æ¥';
                
                ws.send(JSON.stringify({ type: 'auth', token: AUTH_TOKEN }));
                ws.send(JSON.stringify({ type: 'subscribe', showTypes: ['live', 'today', 'early'] }));
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                
                if (data.type === 'full_data') {
                    matches[data.showType] = data.matches;
                    updateCounts();
                    if (data.showType === currentType) renderMatches();
                }
            };

            ws.onerror = () => {
                document.getElementById('statusDot').classList.remove('connected');
                document.getElementById('statusText').textContent = 'è¿æ¥å¤±è´¥';
            };

            ws.onclose = () => {
                document.getElementById('statusDot').classList.remove('connected');
                document.getElementById('statusText').textContent = 'æœªè¿æ¥';
                setTimeout(connect, 5000);
            };
        }

        function updateCounts() {
            document.getElementById('liveCount').textContent = matches.live.length;
            document.getElementById('todayCount').textContent = matches.today.length;
            document.getElementById('earlyCount').textContent = matches.early.length;
        }

        function renderMatches() {
            const container = document.getElementById('matchesContainer');
            const list = matches[currentType];

            if (list.length === 0) {
                container.innerHTML = '<div class="empty">æš‚æ— æ•°æ®</div>';
                return;
            }

            container.innerHTML = list.map(m => `
                <div class="match-card">
                    <div class="match-header">
                        <span>${m.league_zh || m.league}</span>
                        <span>${m.state === 1 ? '<span class="state-badge state-live">è¿›è¡Œä¸­</span>' : ''}</span>
                    </div>
                    <div class="teams">
                        <div class="team">
                            <div class="team-name">${m.home_zh || m.home}</div>
                        </div>
                        ${m.state === 1 ? 
                            `<div class="score">${m.home_score || 0} : ${m.away_score || 0}</div>` :
                            `<div class="vs">VS</div>`
                        }
                        <div class="team">
                            <div class="team-name">${m.away_zh || m.away}</div>
                        </div>
                    </div>
                    ${m.markets ? renderMarkets(m.markets) : ''}
                </div>
            `).join('');
        }

        function renderMarkets(markets) {
            let html = '<div class="markets">';
            
            if (markets.moneyline) {
                html += `
                    <div class="market">
                        <div class="market-title">ç‹¬èµ¢</div>
                        <div class="odds-row">
                            <div class="odds-item">
                                <div class="odds-label">ä¸»èƒœ</div>
                                <div class="odds-value">${markets.moneyline.home?.toFixed(2) || '-'}</div>
                            </div>
                            <div class="odds-item">
                                <div class="odds-label">å¹³å±€</div>
                                <div class="odds-value">${markets.moneyline.draw?.toFixed(2) || '-'}</div>
                            </div>
                            <div class="odds-item">
                                <div class="odds-label">å®¢èƒœ</div>
                                <div class="odds-value">${markets.moneyline.away?.toFixed(2) || '-'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentType = tab.dataset.type;
                renderMatches();
            });
        });

        connect();
    </script>
</body>
</html>

